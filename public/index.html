<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Celsocam Receiver OBS</title>
  <style>
    html, body, video {
      margin: 0;
      width: 100%;
      height: 100%;
      background: #000;
    }
    video { object-fit: contain; }
  </style>
</head>
<body>
  <video id="v" autoplay playsinline></video>
  <script>
    const pc = new RTCPeerConnection({
      iceServers: [{ urls: "stun:stun.l.google.com:19302" }],
    });

    const ws = new WebSocket(`ws://${location.host}`);
    ws.onopen = () => ws.send(JSON.stringify({ role: "browser" }));

    ws.onmessage = async (ev) => {
      const msg = JSON.parse(ev.data);

      if (msg.type === "offer") {
        await pc.setRemoteDescription({ type: "offer", sdp: msg.sdp });
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        ws.send(JSON.stringify({ type: "answer", sdp: answer.sdp }));
      }

      if (msg.type === "ice") {
        pc.addIceCandidate({
          candidate: msg.candidate,
          sdpMid: msg.sdpMid,
          sdpMLineIndex: msg.sdpMLineIndex,
        }).catch(()=>{});
      }

      if (msg.type === "orientation") {
        // si querés, adaptá estilos según portrait/landscape
        document.body.dataset.orientation = msg.orientation;
      }
    };

    pc.onicecandidate = (e) => {
      if (e.candidate) {
        ws.send(JSON.stringify({
          type: "ice",
          candidate: e.candidate.candidate,
          sdpMid: e.candidate.sdpMid,
          sdpMLineIndex: e.candidate.sdpMLineIndex,
        }));
      }
    };

    // Solo video
    pc.addTransceiver("video", { direction: "recvonly" });

    pc.ontrack = (ev) => {
      document.getElementById("v").srcObject = ev.streams[0];
    };
  </script>
</body>
</html>
